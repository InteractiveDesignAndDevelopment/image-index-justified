"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_photoswipe=require("photoswipe"),_photoswipe2=_interopRequireDefault(_photoswipe),_photoswipeUiDefault=require("../default-ui/photoswipe-ui-default.js"),_photoswipeUiDefault2=_interopRequireDefault(_photoswipeUiDefault),_tabtrap=require("tabtrap"),_tabtrap2=_interopRequireDefault(_tabtrap);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var NAME="photoswiper",VERSION="2.0.7",DATA_KEY="photoswiper",Default={bemRoot:null,el:null,onInit:null,photoswipeUI:_photoswipeUiDefault2.default,structure:{PSWP:".pswp",GALLERY:"figure",TITLE:"figcaption",FIGURE:"figure",LINK:"a",THUMB:"img",CAPTION:"figcaption"}},parseArgs=function a(b,c){var d={};switch("undefined"==typeof b?"undefined":_typeof(b)){case"string":d.elements=document.querySelectorAll(b);break;case"object":if(NodeList.prototype.isPrototypeOf(b))d.elements=b;else if(1===b.nodeType){b.setAttribute("nodeListCoercion");var f=document.querySelectorAll("[nodeListCoercion]");b.removeAttribute("nodeListCoercion"),d.elements=f}else void 0===c&&(d.elements=a(b.el).elements,d.config=b);break;default:throw new Error("Initialize with .init(selector, config)");}return"object"===("undefined"==typeof c?"undefined":_typeof(c))&&void 0===d.config&&(d.config=c),d},_isValidPswp=function(b){var c=b.querySelectorAll("a");if(0<c.length){var d=!0,f=!1,g;try{for(var j,k,h=c[Symbol.iterator]();!(d=(j=h.next()).done);d=!0)if(k=j.value,1===k.querySelectorAll("img").length)return!0}catch(l){f=!0,g=l}finally{try{!d&&h.return&&h.return()}finally{if(f)throw g}}}return!1},Photoswiper=function(){function a(b,c){if(_classCallCheck(this,a),this.element=b,this.config=this._getConfig(c),this.structure=this._getStructure(),this.pswpOptions=this._getPswpOptions(),b&&_isValidPswp(b)){this.enabled=!0;var d=window.location.hash.substring(1),f=this._parseHash(d);f.pid&&f.gid&&this._openPhotoSwipe(f.pid,this.element,!0),this._initListeners()}else console.warn("Gallery figures must contain an anchor > image pair (a[href|data-href]>img[src]).\n",b)}return _createClass(a,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"toggle",value:function(){this.enabled=!this.enabled}},{key:"_getConfig",value:function(c){return Object.assign({},Default,c)}},{key:"_getStructure",value:function(){var c=this.config.bemRoot?this._bemSelectors(this.config.bemRoot):{};return Object.assign({},this.config.structure,c)}},{key:"_bemSelectors",value:function(c){return{GALLERY:"."+c,TITLE:"."+c+"__title",FIGURE:"."+c+"__figure",LINK:"."+c+"__link",THUMB:"."+c+"__thumbnail",CAPTION:"."+c+"__caption"}}},{key:"_parseHash",value:function(c){var d={};if(5>c.length)return d;for(var f=c.split("&"),g=0;g<f.length;g++)if(f[g]){var h=f[g].split("=");2>h.length||(d[h[0]]=h[1])}return d.gid&&(d.gid=parseInt(d.gid,10)),d}},{key:"_getPswpOptions",value:function(){var g,c={},d=!0,f=!1;try{for(var j,k,h=Object.keys(this.config)[Symbol.iterator]();!(d=(j=h.next()).done);d=!0)k=j.value,void 0===Default[k]&&(c[k]=this.config[k],delete this.config[k])}catch(l){f=!0,g=l}finally{try{!d&&h.return&&h.return()}finally{if(f)throw g}}return c}},{key:"_initListeners",value:function(){var c=this;this.element.addEventListener("click",function(m){return c._clickEvent(m)});var h,d=document.querySelectorAll("a[href^=\"#\"],a[data-href^=\"#\"]"),f=!0,g=!1;try{for(var k,l,j=d[Symbol.iterator]();!(f=(k=j.next()).done);f=!0)l=k.value,l.addEventListener("click",function(m){return c._clickEvent(m)})}catch(m){g=!0,h=m}finally{try{!f&&j.return&&j.return()}finally{if(g)throw h}}}},{key:"_clickEvent",value:function(c){c=c||window.event;var d=c.target||c.srcElement,f=d.getAttribute("href")||d.getAttribute("data-href");if(f){var g=this._parseHash(f.split("#")[1]);if(g.pid&&g.gid)return this._openPhotoSwipe(g.pid,this.element,!1,d),void(c.preventDefault?c.preventDefault():c.returnValue=!1)}if(this._validClick(d)&&this.enabled){c.preventDefault?c.preventDefault():c.returnValue=!1;var h=d.closest(this.structure.FIGURE)||this.element,j=null;if(h===this.element)j=0;else{var k=this.element.querySelectorAll(this.structure.FIGURE);j=Array.from(k).indexOf(h)}0<=j&&this._openPhotoSwipe(j,this.element,!1,d)}}},{key:"_validClick",value:function(c){var d=c.nodeName.toUpperCase(),f=c.parentElement.nodeName.toUpperCase(),g=1===c.querySelectorAll("img").length;return"IMG"===d&&"A"===f||"A"===d&&g}},{key:"_openPhotoSwipe",value:function(c,d,f,g){if(_isValidPswp(d)){var h=document.querySelector(this.structure.PSWP);if(!h)throw new Error("Make sure to include the .pswp element on your page");if(this.items=this._getItems(d),this.options=this._getOptions(d),this.options.index=parseInt(c,10),f&&(this.options.showAnimationDuration=0,this.options.index=this._urlIndex(c)),!isNaN(this.options.index)){var j=new _photoswipe2.default(h,this.config.photoswipeUI,this.items,this.options);this.enabled&&j.init(),this._manageFocus(j,g,h),"function"==typeof this.config.onInit&&this.config.onInit.call(j,j)}}}},{key:"_getItems",value:function(c){var d=this,f=c.querySelectorAll(this.structure.FIGURE);return 0<f.length?Array.from(f).map(function(g){return d._getItem(g)}):[this._getItem(c)]}},{key:"_getItem",value:function(c){var d=c.querySelector(this.structure.LINK),f=c.querySelector(this.structure.THUMB),g=c.querySelector(this.structure.CAPTION),h=d.getAttribute("data-size").split("x"),j={el:c,h:parseInt(h[1],10),w:parseInt(h[0],10),src:d.getAttribute("href")||d.getAttribute("data-href")};return f&&(j.alt=f.getAttribute("alt"),j.msrc=f.getAttribute("src")),g&&0<g.innerHTML.length&&(j.title=g.innerHTML),j}},{key:"_getOptions",value:function(c){var d=this,f=this.structure.THUMB;return Object.assign({},this.pswpOptions,{galleryUID:c.getAttribute("data-pswp-uid"),getThumbBoundsFn:function(h){var j=d.items[h].el.querySelector(f),k=window.pageYOffset||document.documentElement.scrollTop,l=j.getBoundingClientRect();return{x:l.left,y:l.top+k,w:l.width}}})}},{key:"_urlIndex",value:function(c,d,f){if(f){for(var g=0;g<d.length;g++)if(d[g].pid==c)return g;}else return parseInt(c,10)-1}},{key:"_manageFocus",value:function(c,d,f){var g=this;new _tabtrap2.default(f);var h=0;f.addEventListener("keydown",function(j){var k=j.which||j.keyCode||0;9===k&&(c.ui.setIdle(!1),clearTimeout(h),h=setTimeout(function(){c.ui.setIdle(!0)},c.options.timeToIdle))}),c.listen("close",function(){var j=c.getCurrentIndex(),k=g.element.querySelectorAll(g.structure.FIGURE)[j]||g.element;g.element.contains(d)||!d?k.querySelector(g.structure.LINK).focus():d.focus()})}}],[{key:"initAll",value:function(c,d){var f=parseArgs(c,d);return Array.from(f.elements).filter(function(g){return _isValidPswp(g)}).map(function(g,h){return g.setAttribute("data-pswp-uid",h+1),new a(g,f.config)})}},{key:"_jQueryInterface",value:function(c){var d=0;return this.each(function(){if(_isValidPswp(this)){d++;var f=jQuery(this).data(DATA_KEY),g="object"===("undefined"==typeof c?"undefined":_typeof(c))?c:{};if(g.el=this,!f&&/dispose|hide/.test(c))return;if(f||(this.setAttribute("data-pswp-uid",d),f=new a(this,g),jQuery(this).data(DATA_KEY,f)),"string"==typeof c){if(void 0===f[c])throw new Error("No method named \"jQuery{config}\"");f[c]()}}})}},{key:"isValidPswp",value:function(c){return _isValidPswp(c)}},{key:"NAME",get:function(){return NAME}},{key:"VERSION",get:function(){return VERSION}},{key:"DATA_KEY",get:function(){return DATA_KEY}},{key:"Default",get:function(){return Default}}]),a}();if(window.jQuery!==void 0){var JQUERY_NO_CONFLICT=jQuery.fn[NAME];jQuery.fn[NAME]=Photoswiper._jQueryInterface,jQuery.fn[NAME].Constructor=Photoswiper,jQuery.fn[NAME].noConflict=function(){return jQuery.fn[NAME]=JQUERY_NO_CONFLICT,Photoswiper._jQueryInterface}}exports.default=Photoswiper;
